# CalorieSnap - 拍照计算热量 Android App 需求文档

## 1. 产品概述

### 1.1 产品名称
CalorieSnap（卡路里快拍）

### 1.2 产品定位
一款基于AI图像识别的智能热量计算Android应用，用户通过拍照即可识别食物并计算热量，结合个人身体数据提供每日能量收支分析。

### 1.3 目标用户
- 健身减脂人群
- 健康饮食管理者
- 糖尿病/慢性病患者
- 营养师及健康从业者

---

## 2. 功能需求

### 2.1 核心功能：食物热量记录

应用支持两种模式：**AI模式**（需配置API）和**手动模式**（无需网络），确保无AI时也能正常使用。

#### 2.1.1 添加食物方式
| 方式 | 描述 | 是否需要AI |
|------|------|------------|
| 拍照识别 | 拍照后AI自动识别食物和热量 | 是 |
| 相册导入 | 从相册选图后AI识别 | 是 |
| 手动搜索 | 从本地食物数据库搜索添加 | 否 |
| 快速添加 | 从收藏/最近使用中快速添加 | 否 |
| 自定义录入 | 手动输入食物名称和热量 | 否 |

#### 2.1.2 AI识别功能（可选）
| 功能项 | 描述 |
|--------|------|
| 食物识别 | 调用AI模型识别图片中的食物种类 |
| 份量估算 | 根据图片估算食物重量/份量 |
| 热量计算 | 返回总热量及营养成分（蛋白质、碳水、脂肪）|
| 多食物识别 | 支持一张图片中识别多种食物 |
| 结果编辑 | 用户可手动修正识别结果（见下方详细说明）|
| AI饮食建议 | 根据用户目标给出个性化建议（见2.3.3）|

##### 识别结果编辑功能
AI识别完成后，用户可在结果页面对食物和份量进行调整：

| 编辑操作 | 描述 |
|----------|------|
| 修改食物名称 | 点击食物名称可手动修改或从数据库重新选择 |
| 调整克数 | 输入框直接输入克数，实时更新热量和营养素 |
| 克数快捷选项 | 提供50g/100g/150g/200g等常用克数按钮 |
| 删除食物 | 移除识别错误的食物项 |
| 添加食物 | 手动添加AI未识别到的食物 |
| 修改营养素 | 可单独调整蛋白质/碳水/脂肪数值 |
| 重新识别 | 对当前图片重新调用AI识别 |

#### 2.1.3 手动记录功能（无需AI）
| 功能项 | 描述 |
|--------|------|
| 食物数据库搜索 | 内置常见食物数据库，支持中文搜索 |
| 克数输入 | 直接输入食物克数，自动计算热量 |
| 常用克数快捷选项 | 提供50g/100g/150g/200g等快捷按钮 |
| 收藏食物 | 常吃食物一键添加 |
| 最近使用 | 快速访问最近添加的食物 |
| 自定义食物 | 用户可添加自定义食物及营养数据（每100g）|
| 条形码扫描 | 扫描食品包装条形码获取营养信息（v1.2）|

#### 2.1.4 自定义模型API配置（可选）
| 配置项 | 描述 |
|--------|------|
| 启用AI功能 | 开关控制是否使用AI识别 |
| Base URL | 支持自定义API服务器地址 |
| API Key | 支持配置API密钥 |
| 模型选择 | 支持选择/输入不同模型名称（如gpt-4o, claude-3, qwen-vl等）|
| 请求超时 | 可配置请求超时时间 |
| 预设模板 | 提供常用API服务商预设（OpenAI, Claude, 通义千问等）|
| 连接测试 | 测试API配置是否有效 |

---

### 2.2 用户身体数据管理

#### 2.2.1 基础信息录入
| 数据项 | 类型 | 说明 |
|--------|------|------|
| 性别 | 选择 | 男/女 |
| 年龄 | 数字 | 1-120岁 |
| 身高 | 数字 | cm |
| 体重 | 数字 | kg |
| 活动水平 | 选择 | 久坐/轻度活动/中度活动/重度活动/专业运动员 |
| 目标 | 选择 | 减脂/维持/增肌 |

#### 2.2.2 身体数据记录
| 功能项 | 描述 |
|--------|------|
| 体重记录 | 支持每日记录体重变化 |
| 体重趋势图 | 可视化展示体重变化曲线 |
| 体脂率（可选）| 支持记录体脂率 |

---

### 2.3 每日能量收支计算

#### 2.3.1 基础代谢率(BMR)计算
采用 Mifflin-St Jeor 公式：
- 男性: BMR = 10×体重(kg) + 6.25×身高(cm) - 5×年龄 + 5
- 女性: BMR = 10×体重(kg) + 6.25×身高(cm) - 5×年龄 - 161

#### 2.3.2 每日总消耗(TDEE)计算
TDEE = BMR × 活动系数

| 活动水平 | 系数 |
|----------|------|
| 久坐（几乎不运动）| 1.2 |
| 轻度活动（每周1-3天）| 1.375 |
| 中度活动（每周3-5天）| 1.55 |
| 重度活动（每周6-7天）| 1.725 |
| 专业运动员 | 1.9 |

#### 2.3.3 目标热量计算与个性化建议

##### 基础目标热量
| 目标 | 默认计算方式 |
|------|----------|
| 减脂 | TDEE - 500 kcal（每周减约0.5kg）|
| 维持 | TDEE |
| 增肌 | TDEE + 300 kcal |

##### 自定义热量缺口/盈余
| 配置项 | 描述 |
|--------|------|
| 自定义缺口 | 减脂用户可自定义热量缺口（200-1000 kcal）|
| 自定义盈余 | 增肌用户可自定义热量盈余（100-500 kcal）|
| 预设选项 | 提供保守/标准/激进三档预设 |
| 安全提醒 | 缺口过大时提示健康风险 |

减脂预设：
- 保守：TDEE - 300 kcal（每周减约0.3kg）
- 标准：TDEE - 500 kcal（每周减约0.5kg）
- 激进：TDEE - 750 kcal（每周减约0.75kg，需谨慎）

增肌预设：
- 保守：TDEE + 200 kcal（精益增肌）
- 标准：TDEE + 300 kcal
- 激进：TDEE + 500 kcal（快速增重）

##### AI个性化饮食建议
识别食物后，根据用户目标调用AI模型生成个性化建议：

| 用户目标 | AI建议方向 |
|----------|------------|
| 减脂 | 低热量替代方案、饱腹感建议、避免高糖高脂提醒 |
| 维持 | 营养均衡建议、食物搭配优化 |
| 增肌 | 蛋白质摄入建议、增加热量的健康方式、训练前后饮食建议 |

AI建议Prompt模板（追加到识别请求中）：
```
用户目标：{goal}（减脂/维持/增肌）
今日已摄入：{consumed} kcal
目标热量：{target} kcal
剩余可摄入：{remaining} kcal

请根据用户目标，针对本次识别的食物给出个性化建议：
1. 这顿饭对用户目标的影响评估
2. 具体的饮食调整建议
3. 如有需要，推荐更适合目标的替代食物
```

#### 2.3.4 每日统计面板
| 展示项 | 描述 |
|--------|------|
| 今日摄入 | 当日已记录的总热量 |
| 目标热量 | 根据用户目标计算的建议摄入 |
| 剩余可摄入 | 目标热量 - 今日摄入 |
| 营养素分布 | 蛋白质/碳水/脂肪的摄入占比 |
| 进度环 | 可视化展示完成度 |

---

### 2.4 饮食记录管理

#### 2.4.1 餐次分类
- 早餐
- 午餐
- 晚餐
- 加餐/零食

#### 2.4.2 记录功能
| 功能项 | 描述 |
|--------|------|
| 添加记录 | 通过拍照或手动搜索添加 |
| 编辑记录 | 修改已添加的食物和份量 |
| 删除记录 | 删除错误记录 |
| 历史查看 | 按日期查看历史饮食记录 |
| 收藏食物 | 常吃食物快速添加 |

#### 2.4.3 食物数据库
| 功能项 | 描述 |
|--------|------|
| 本地数据库 | 内置常见食物热量数据 |
| 搜索功能 | 支持中文搜索食物 |
| 自定义食物 | 用户可添加自定义食物及热量 |
| 最近使用 | 快速访问最近添加的食物 |

---

### 2.5 数据统计与报告

#### 2.5.1 统计维度
| 维度 | 描述 |
|------|------|
| 日统计 | 当日热量摄入详情 |
| 周统计 | 一周热量摄入趋势 |
| 月统计 | 月度热量及体重变化 |

#### 2.5.2 图表展示（本地计算，无需AI）
- 热量摄入柱状图
- 营养素饼图（蛋白质/碳水/脂肪占比）
- 体重变化折线图
- 目标达成率环形图
- 每日热量缺口/盈余趋势

#### 2.5.3 本地数据分析（无需AI）
| 分析项 | 描述 |
|--------|------|
| 目标完成率 | 本周/本月达标天数占比 |
| 平均摄入 | 周/月平均每日热量摄入 |
| 营养素均衡度 | 蛋白质/碳水/脂肪是否符合推荐比例 |
| 热量波动 | 摄入热量的稳定性分析 |
| 体重趋势 | 预测按当前趋势的体重变化 |
| 高频食物 | 统计最常吃的食物TOP10 |
| 餐次分布 | 早/午/晚/加餐的热量占比 |

#### 2.5.4 AI智能分析（需配置API）
| 功能项 | 描述 |
|--------|------|
| 周报总结 | AI分析本周饮食情况，生成文字总结 |
| 问题诊断 | 识别饮食中的问题（如蛋白质不足、晚餐过量等）|
| 下周建议 | 根据本周数据和用户目标，给出下周饮食建议 |
| 食物推荐 | 推荐适合用户目标的食物清单 |
| 习惯分析 | 分析用户饮食习惯的优缺点 |

AI周报Prompt模板：
```
用户目标：{goal}
本周数据摘要：
- 平均每日摄入：{avg_calories} kcal（目标：{target} kcal）
- 目标达成天数：{achieved_days}/7
- 营养素平均占比：蛋白质{protein}%、碳水{carbs}%、脂肪{fat}%
- 体重变化：{weight_change} kg
- 高频食物：{top_foods}

请分析本周饮食情况并给出：
1. 本周饮食总结（优点和问题）
2. 针对用户{goal}目标的具体改进建议
3. 下周饮食计划建议
```

---

### 2.6 数据导入/导出

| 功能项 | 描述 |
|--------|------|
| 导出数据 | 将所有记录导出为JSON文件 |
| 导入数据 | 从JSON文件导入记录 |
| 导出范围 | 可选择导出全部或指定日期范围 |
| 导入策略 | 支持覆盖或合并现有数据 |
| 分享文件 | 导出后可通过系统分享发送 |

导出JSON格式示例：
```json
{
  "version": "1.0",
  "exportDate": "2024-01-01T12:00:00Z",
  "userProfile": {
    "gender": "male",
    "age": 25,
    "height": 175,
    "weight": 70,
    "activityLevel": "moderate",
    "goal": "lose_weight",
    "calorieDeficit": 500
  },
  "foodRecords": [
    {
      "date": "2024-01-01",
      "meal": "breakfast",
      "foods": [
        {
          "name": "鸡蛋",
          "weight": 100,
          "calories": 144,
          "protein": 13.3,
          "carbs": 1.1,
          "fat": 9.5
        }
      ]
    }
  ],
  "weightRecords": [
    { "date": "2024-01-01", "weight": 70.5 }
  ],
  "customFoods": [],
  "favoriteFoods": []
}
```

---

## 3. 非功能需求

### 3.1 性能要求
| 指标 | 要求 |
|------|------|
| 图片识别响应 | < 10秒（取决于网络和API）|
| 应用启动时间 | < 2秒 |
| 本地数据查询 | < 500ms |

### 3.2 兼容性
| 项目 | 要求 |
|------|------|
| Android版本 | Android 8.0 (API 26) 及以上 |
| 屏幕适配 | 支持主流分辨率 |
| 语言 | 中文（简体）|

### 3.3 安全性
| 项目 | 要求 |
|------|------|
| API Key存储 | 加密存储在本地 |
| 数据存储 | 本地SQLite/Room数据库 |
| 网络请求 | 支持HTTPS |

### 3.4 隐私
- 所有数据存储在本地
- 图片仅用于API识别，不上传至第三方服务器（除用户配置的API）
- 无需注册登录

---

## 4. 技术架构建议

### 4.1 技术栈
| 层级 | 技术选型 |
|------|----------|
| 开发语言 | Kotlin |
| UI框架 | Jetpack Compose |
| 架构模式 | MVVM + Clean Architecture |
| 本地数据库 | Room |
| 网络请求 | Retrofit + OkHttp |
| 图片处理 | Coil |
| 依赖注入 | Hilt |
| 异步处理 | Kotlin Coroutines + Flow |

### 4.2 模块划分
```
app/
├── data/           # 数据层
│   ├── local/      # Room数据库、SharedPreferences
│   ├── remote/     # API服务
│   └── repository/ # 数据仓库
├── domain/         # 业务逻辑层
│   ├── model/      # 领域模型
│   └── usecase/    # 用例
├── presentation/   # 表现层
│   ├── home/       # 首页
│   ├── camera/     # 拍照识别
│   ├── profile/    # 个人信息
│   ├── history/    # 历史记录
│   ├── settings/   # 设置（API配置）
│   └── statistics/ # 统计报告
└── di/             # 依赖注入
```

### 4.3 API调用设计
```kotlin
// 通用多模态API请求格式
data class VisionRequest(
    val model: String,
    val messages: List<Message>,
    val max_tokens: Int = 1024
)

data class Message(
    val role: String,
    val content: List<Content>
)

data class Content(
    val type: String,  // "text" or "image_url"
    val text: String? = null,
    val image_url: ImageUrl? = null
)

data class ImageUrl(
    val url: String  // base64编码的图片
)
```

---

## 5. 界面原型

### 5.1 主要页面
1. **首页** - 今日摄入概览、快速拍照入口
2. **拍照页** - 相机预览、拍照按钮、相册入口
3. **识别结果页** - 食物列表、热量详情、确认添加
4. **历史记录页** - 按日期查看饮食记录
5. **统计页** - 图表展示热量趋势
6. **个人信息页** - 身体数据录入与管理
7. **设置页** - API配置、应用设置

### 5.2 交互流程

**AI模式流程：**
```
首页 → 点击拍照 → 拍照/选图 → AI识别 → 显示结果+AI建议 → 确认/编辑 → 保存记录 → 返回首页
```

**手动模式流程：**
```
首页 → 点击添加 → 搜索食物/选择收藏/自定义录入 → 选择份量 → 保存记录 → 返回首页
```

---

## 6. 版本规划

### v1.0 MVP
- [x] 拍照识别食物热量
- [x] 自定义API配置
- [x] 基础身体数据录入
- [x] BMR/TDEE计算
- [x] 每日摄入记录
- [x] 简单统计展示

### v1.1
- [ ] 食物数据库搜索
- [ ] 收藏常用食物
- [ ] 周/月统计报告
- [ ] 体重记录与趋势图

### v1.2
- [ ] 数据导入/导出（JSON）
- [ ] 深色模式
- [ ] Widget小组件
- [ ] 多语言支持

---

## 7. 风险与挑战

| 风险 | 应对策略 |
|------|----------|
| AI识别准确率 | 允许用户手动修正；提供食物数据库搜索作为备选 |
| API费用 | 用户自行配置API Key，费用由用户承担 |
| 份量估算不准 | 提供常见份量选项（小/中/大份）供用户选择 |
| 网络依赖 | 本地缓存常见食物数据，离线时可手动搜索添加 |

---

## 8. 附录

### 8.1 常见食物热量参考（内置数据库）
| 食物 | 热量(kcal/100g) | 蛋白质(g) | 碳水(g) | 脂肪(g) |
|------|-----------------|-----------|---------|---------|
| 米饭 | 116 | 2.6 | 25.6 | 0.3 |
| 面条 | 137 | 4.5 | 28.4 | 0.8 |
| 鸡胸肉 | 133 | 31 | 0 | 1.2 |
| 鸡蛋 | 144 | 13.3 | 1.1 | 9.5 |
| 牛肉 | 125 | 19.9 | 0 | 4.2 |
| 西兰花 | 34 | 4.3 | 4.0 | 0.4 |
| 苹果 | 52 | 0.3 | 13.8 | 0.2 |

### 8.2 Prompt模板参考
```
你是一个专业的营养师AI助手。请分析这张食物图片，识别其中的食物并估算热量。

请按以下JSON格式返回结果：
{
  "foods": [
    {
      "name": "食物名称",
      "weight_g": 估算重量(克),
      "calories": 热量(kcal),
      "protein": 蛋白质(g),
      "carbs": 碳水化合物(g),
      "fat": 脂肪(g),
      "confidence": 置信度(0-1)
    }
  ],
  "total_calories": 总热量,
  "meal_description": "简短描述这顿饭"
}
```

---

文档版本：v1.0
创建日期：2024年
